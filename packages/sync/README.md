<p align="center">
  <img src="https://image.flaticon.com/icons/svg/135/135673.svg" width="300" height="300" alt="unistore">
    <br>
    <br>
    <a href="https://www.npmjs.org/package/mutasync">
      <img src="https://img.shields.io/npm/v/mutasync.svg?style=flat" alt="npm">
    </a>
</p>

# mutasync

> Syncs your state manager offline & online

Mutasync provides an easy way to save state in localStorage, authenticate and save mutations online using a mutasync-server. It allows to build apps that are meant "front first" where we put all trust in user's browser. It is well suited for ideas where there is no real usage of a database. See [mutasync-server](https://github.com/krzepah/State-Management-Server) github page for more information regarding how data is used.

:bomb: For now mutasync works with [mutastore](https://github.com/krzepah/StoreSync) (a forked version of unistore) a pending [PR](https://github.com/developit/unistore/pull/161) to Unistore is open. If merged mutastore could then cease to exist preferably for Unistore

- Saves in LocalStorage
- Saves online
- Works with JWT
- Dead small & simple code

## Install

This project uses [node](http://nodejs.org) and [npm](https://npmjs.com). Go check them out if you don't have them locally installed.

```sh
npm install --save mutasync
```

### Usage

Here is a [codesandbox example](https://codesandbox.io/s/github/krzepah/storesync-example)

Mutasync works best with [mutastore](https://github.com/krzepah/mutastore), any compatible store should do, but for now you have to go trough the installation and usage of mutastore.

Once installed,

### Mandatory step

    import sync from 'mutasync';

    const SYNC = sync({
      host: 'your-end-point'
    })

    // This handle submission of mutations to save
    store.subscribe(SYNC.apply)

### To handle localStorage

    class App extends Component {
      componentDidMount = () => store.setState(
        sync('mytoken').retrieveLocal()
      )

      render = () => <div id="app">
        <Provider store={store}>
          <Page />
        </Provider>
      </div>
    }

### To handle authentication

    const LoginBase = ({login}) => <form onSubmit={
      (e) => {
        e.preventDefault();
        login( e.target[0].value, e.target[1].value )
      }
    }>
      <label>Username</label>
      <input type="text" id="email" />
      <label>Password</label>
      <input type="password" id="password" />
      <button type="submit">Login</button>
      <button onClick={(e) => {
        e.preventDefault();
        sync('mytoken').clearLocal(defaults)
        store.mutate({logout: defaults}, true)
      }}>Logout</button>
    </form>

    const Login = connect(
      (state, props) => ({...state}),
      (state, props) => ({
        login: (state, username, password) => SYNC
          .auth( username, password )
          .then( (res) => res.json() )
          .then( (res) => ({ authenticate: { ...res }, sync: false }))
          .catch(function(res) {
             console.log('error :', res);
          })
      })
    )(LoginBase)

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

- [listen](#listen)
    -   [Parameters](#parameters)

### listen

Should be set in a store.subscribe.
Saves state using storage and batch update

#### Parameters

- `state`  
- `action`  
- `params`  
